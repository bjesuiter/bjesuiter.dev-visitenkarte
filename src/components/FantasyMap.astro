---
---

<div id="fantasy-map-container">
  <div id="land-label"></div>
  <div id="map-instructions">
    <span>Hover over lands to explore</span>
  </div>
</div>

<style>
  #fantasy-map-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: #8b9da6;
  }

  #fantasy-map-container :global(canvas) {
    display: block;
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  }

  #land-label {
    z-index: 10;
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(10px);
    padding: 12px 24px;
    background: rgba(58, 50, 40, 0.9);
    color: #f5f0e6;
    font-family: Georgia, "Times New Roman", serif;
    font-size: 1.5rem;
    font-weight: bold;
    border-radius: 4px;
    pointer-events: none;
    opacity: 0;
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(139, 115, 85, 0.6);
    box-shadow:
      0 4px 20px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  #map-instructions {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 16px;
    background: rgba(58, 50, 40, 0.7);
    color: #d4c9b8;
    font-family: Georgia, "Times New Roman", serif;
    font-size: 0.9rem;
    font-style: italic;
    border-radius: 4px;
    pointer-events: none;
    opacity: 0.8;
    transition: opacity 0.3s ease;
    z-index: 10;
  }

  #fantasy-map-container:hover #map-instructions {
    opacity: 0.4;
  }

  @media (max-width: 768px) {
    #land-label {
      font-size: 1.2rem;
      padding: 10px 20px;
      bottom: 100px;
    }

    #map-instructions {
      font-size: 0.8rem;
      bottom: 15px;
    }
  }
</style>

<script>
  import { FantasyMapCanvas } from "./map/MapCanvas.ts";

  let mapCanvas: FantasyMapCanvas | null = null;

  function initMap() {
    const container = document.getElementById(
      "fantasy-map-container"
    ) as HTMLElement;
    const labelElement = document.getElementById("land-label") as HTMLDivElement;

    if (container && labelElement) {
      mapCanvas = new FantasyMapCanvas(container, labelElement);
    }
  }

  function cleanupMap() {
    if (mapCanvas) {
      mapCanvas.dispose();
      mapCanvas = null;
    }
  }

  document.addEventListener("astro:page-load", initMap);
  document.addEventListener("astro:before-swap", cleanupMap);

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initMap);
  } else {
    initMap();
  }
</script>
